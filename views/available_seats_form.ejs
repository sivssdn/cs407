<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="msapplication-tap-highlight" content="no">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta name="theme-color" content="black">

    <title>Ashoka Cabs</title>

    <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">

    <link type="text/css" rel="stylesheet" href="/css/materialize_0_100_2.css">
    <link type="text/css" rel="stylesheet" href="/css/animate.css">
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        @media only screen and (max-width: 990px) {
            html, body {
                background-color: #000000;
                color: #ffffff;
            }
        }

        @media only screen and (min-width: 992px) {
            html {
                background-image: url("/images/bg_ashoka.jpg");
                background-repeat: no-repeat;
                background-size: cover;
                background-attachment: fixed;
                color: #ffffff;
            }
        }

        th {
            text-align: center;
        }

        .card-padding {
            padding-top: 5% !important;
            padding-bottom: 5% !important;
        }

        .button-availability:hover {
            content: 'ADD';
        }

        #toast-container {
            top: auto !important;
            right: 7%;
            bottom: 10%;
            left: auto !important;
        }
    </style>
</head>
<body>

<ul id="profile_dropdown" class="dropdown-content">
    <li><a href="/authentication/logout">Sign Out</a></li>
</ul>
    <nav class="navbar-fixed blue darken-4 z-depth-2 ">
        <div class="nav-wrapper">
            <a class="brand-logo"> &nbsp;Ashoka Cabs <sub>(beta)</sub></a>
            <a data-activates="mobile-side-menu" class="button-collapse"><i class="material-icons">menu</i></a>
            <ul class="right hide-on-med-and-down">
                <li><a href="/user/vehicles/add">Add Vehicle</a></li>
                <li><a href="/user/vehicles">My Vehicles</a></li>
                <li><a href="/user/bookings">My Bookings</a></li>
                <li class="active"><a href="/vehicles">Make Bookings</a></li>
                <li><a href="/user/edit" class="dropdown-button" data-activates="profile_dropdown">My Profile</a></li>
            </ul>
        </div>
    </nav>

    <ul class="side-nav black-text" id="mobile-side-menu">
        <li><a href="/user/vehicles/add">Add Vehicle</a></li>
        <li><a href="/user/vehicles">My Vehicles</a></li>
        <li><a href="/user/bookings">My Bookings</a></li>
        <li  class="active"><a href="/vehicles">Make Bookings</a></li>
        <li><a href="/user/edit">My Profile</a></li>
        <li><a href="/authentication/logout">Sign Out</a></li>
    </ul>

<main>
    <div class="section"></div>

    <div class="row animated bounceInDown">
        <div class="section hide-on-small-and-down"></div>
        <h4 class="center">Make Bookings</h4>

        <div class="col l7 m5 push-l2 s12">
            <table class="center">
                <tbody>
                <tr>
                    <td>
                        <h5>Choose Date</h5>
                    </td>
                    <td>
                        <div class="input-field">
                            <input type="text" id="departure_date" class="datepicker">
                            <label for="departure_date">Select date</label>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <h5>Choose Time Range</h5>
                    </td>
                    <td>
                        <div class="input-field">
                            <input type="text" id="departure_time1" class="timepicker">
                            <label for="departure_time1">Time 1</label>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <h5></h5>
                    </td>
                    <td>
                        <div class="input-field">
                            <input type="text" id="departure_time2" class="timepicker">
                            <label for="departure_time2">Time 2</label>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <h5>Place of Departure</h5>
                    </td>
                    <td>
                        <div class="input-field">
                            <select id="departure_place">
                                <option value="Campus" selected>Campus</option>
                                <option value="Parker">Parker</option>
                                <option value="Jahangirpuri">Jahangirpuri</option>
                                <option value="Sonepat">Sonepat</option>
                                <option value="Airport T3">Airport T3</option>
                                <option value="Airport T2">Airport T2</option>
                            </select>
                            <label for="departure_place">Click here to select place</label>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <h5>Select Destination</h5>
                    </td>
                    <td>
                        <div class="input-field">
                            <select id="arrival_place">
                                <option value="Campus">Campus</option>
                                <option value="Parker">Parker</option>
                                <option value="Jahangirpuri" selected>Jahangirpuri</option>
                                <option value="Sonepat">Sonepat</option>
                                <option value="Airport T3">Airport T3</option>
                                <option value="Airport T2">Airport T2</option>
                            </select>
                            <label for="arrival_place">Click here to select place</label>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th colspan="2">
                        <button class="btn btn-large waves-effect waves-light blue darken-4" type="submit"
                                id="submit_available_seats_form">Submit
                        </button>
                    </th>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <form action="/vehicles" method="post" id="available_seats_form">
        <input name="source" id="source" hidden>
        <input name="destination" id="destination" hidden>
        <input name="time1" id="time1" hidden>
        <input name="time2" id="time2" hidden>
        <input name="date" id="date" hidden>
    </form>
    <div class="section"></div>
</main>

<footer class="page-footer blue darken-4">
    <div class="footer-copyright">
        <div class="container">
            Â©  Copyright Ashoka University
            <a class="btn red darken-1 right" href="https://goo.gl/forms/hGHBiA21kKbMsz9w1">FEEDBACK</a>
        </div>
    </div>
</footer>

</body>
<script type="text/javascript" src="/javascripts/jquery.js"></script>
<script type="text/javascript" src="/javascripts/materialize_0_100_2_min.js"></script>
<script>
    $(document).ready(function () {

        $(".button-collapse").sideNav();
        $('.datepicker').pickadate({
            selectMonths: true, // Creates a dropdown to control month
            selectYears: 1, // Creates a dropdown of 15 years to control year,
            today: 'Today',
            clear: 'Clear',
            close: 'Ok',
            closeOnSelect: true, // Close upon selecting a date,
            format: 'dd-mm-yyyy',
            min: new Date()
        });
        $('.timepicker').pickatime({
            default: 'now', // Set default time: 'now', '1:30AM', '16:30'
            fromnow: 0,       // set default time to * milliseconds from now (using with default = 'now')
            twelvehour: false, // Use AM/PM or 24-hour format
            donetext: 'OK', // text for done-button
            cleartext: 'Clear', // text for clear-button
            canceltext: 'Cancel', // Text for cancel-button
            autoclose: true, // automatic close timepicker
            ampmclickable: true, // make AM PM clickable
            aftershow: function () {
            } //Function for after opening timepicker
        });
        $('select').material_select();
        $(".dropdown-button").dropdown({
            hover: true,
            belowOrigin: true,
            constrainWidth: false,
            gutter: 0
        });

        function dateToday() {
            //gets present date from user device
            var today = new Date();
            var dd = today.getDate();
            var mm = today.getMonth() + 1; //January is 0!

            var yyyy = today.getFullYear();
            if (dd < 10) {
                dd = '0' + dd;
            }
            if (mm < 10) {
                mm = '0' + mm;
            }
            return dd + '-' + mm + '-' + yyyy;
        }

        //returns present time on users machine
        function timeNow(increment_hour) {
            var date = new Date(); // for now
            increment_hour = parseInt(increment_hour) || 0;
            date.setHours(date.getHours() + increment_hour);
            var hours = date.getHours(), minutes = date.getMinutes();
            if(hours < 10){
                hours = "0"+hours;
            }else if(hours.length === 1){
                hours = hours+"0";
            }
            if(minutes < 10){
                minutes = "0"+minutes;
            }else if(hours.length === 1){
                minutes = minutes+"0";
            }
            return hours+":"+minutes;
        }
        //for placing default value in departure_date field
        document.getElementById("departure_date").value=dateToday();
        document.getElementById("departure_time1").value=timeNow();
        updateTime2();


        //to fill departure_time2 to the next hour when departure_time1 is changed
        $("#departure_time1").on('change',function () {
            updateTime2();
        });


        function updateTime2(){
            var time_selected = document.getElementById("departure_time1").value;
            var date = new Date(); // for now
            date.setHours(parseInt(time_selected.split(":")[0]) + 1);
            date.setMinutes(parseInt(time_selected.split(":")[1]));
            var hours = date.getHours(), minutes = date.getMinutes();
            if(hours < 10){
                hours = "0"+hours;
            }else if(hours.length === 1){
                hours = hours+"0";
            }
            if(minutes < 10){
                minutes = "0"+minutes;
            }else if(hours.length === 1){
                minutes = minutes+"0";
            }
            document.getElementById("departure_time2").value=hours+":"+minutes;

            if(validateTimeRange() === -1){
                document.getElementById("departure_time2").value="23:59";
            }
        }

        $("#departure_time2").on("change", function () {

            if(validateTimeRange() === -1){
                Materialize.toast("Time 2 must be greater than Time 1", 3000, 'rounded');
                document.getElementById("departure_time2").value=document.getElementById("departure_time1").value;
            }
        });

        function validateTimeRange(){
            if(parseInt(document.getElementById("departure_time2").value.replace(/:/g,'')) < parseInt(document.getElementById("departure_time1").value.replace(/:/g,''))){
                return -1;
            }else {
                return 1;
            }
        }

        //submitting form
        document.getElementById("submit_available_seats_form").addEventListener("click", function () {
            if (document.getElementById("departure_place").value.length < 1) {
                Materialize.toast("Place of Departure empty", 3000, 'rounded');
            } else if (document.getElementById("arrival_place").value.length < 1) {
                Materialize.toast("Destination empty", 3000, 'rounded');
            } else if (document.getElementById("departure_time1").value.length < 1 || document.getElementById("departure_time2").value.length < 1) {
                Materialize.toast("Time empty", 3000, 'rounded');
            } else if (document.getElementById("departure_date").value.length < 1) {
                Materialize.toast("Departure date empty", 3000, 'rounded');
            } else {
                document.getElementById("source").value = document.getElementById("departure_place").value;
                document.getElementById("destination").value = document.getElementById("arrival_place").value;
                document.getElementById("time1").value = document.getElementById("departure_time1").value;
                document.getElementById("time2").value = document.getElementById("departure_time2").value;
                document.getElementById("date").value = document.getElementById("departure_date").value;
                document.getElementById("available_seats_form").submit();
            }

        });


        <%if(typeof message != 'undefined'){ %>
        Materialize.toast('<%=message%>',4000);
        <%}%>
    });

    //to avoid field scrambling when the page is reached through back button
    $(window).bind("pageshow", function() {
        //alert();
        document.getElementById("departure_place").value="Campus";
        document.getElementById("arrival_place").value="Jahangirpuri";
        $('select').material_select();
    });
</script>
</html>
